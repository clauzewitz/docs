# Apple 샌드박스 영수증 검증시 21004 에러

## 구독 상품을 구매 이력이 없는 영수증 검증 시 21004 에러
2019년 12월부터 샌드박스 영수증 검증 시에 구독 상품을 구매한 이력이 없는 영수증에 대해서도 21004 에러가 발생하는 이슈가 생겼다.
검증 시 사용되는 파라메터는 영수증을 값으로 하는 **receipt-date** 와 Shared Secret 을 값으로 하는 **password** 항목으로 이루어진 json 객체인데 기존에는 password 항목을 빈 값으로 보내어도 영수증 검증이 가능했었지만 지금은 password 항목이 없거나, 올바른 Shared Secret 을 넣어야만 조회가 되도록 샌드박스 환경이 변경되었다.
라이브 환경에서는 영수증 검증을 시도하면 기존과 같이 password 항목에 값이 비어있더라도 정상적으로 조회가 되는 것을 보아 샌드박스 환경에서만 적용된 것으로 보이며 이를 해결하기 위한 방법은 아래와 같다.
* receipt-data 항목만을 파라메터로 전달한다.
	+ password 항목은 절대로 전달하지 않는다. 빈 값으로도 보내면 21004 에러가 발생한다.
* password 항목에 Shared Secret 값을 설정하여 전달한다.
	+ 라이브 환경에서도 구독 상품을 구매한 이력이 없는 영수증도 정상적으로 검증이 가능하다.